= Header Injection Policy
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: header, policy

API Manager supports policies for adding HTTP headers from a request or response. The policies take effect before sending the request or response. The Header Injection policy performs the following actions:

* Adds one or more headers into a request from the client to the backend service, or overrides the value of an existing header. 
* Adds one or more headers into a response from the backend service to the client, or overrides the header value in a response from the backend service.

// == Prerequisites for the Policy

// The prerequisites for using the header policies are:

// * You must have Organization Administrators or API Versions Owner privileges for an API version you want to manage in Anypoint Platform. One of your API version management tasks is applying policies.
// * Ensure that you are licensed to use API Manager functionality (Mule 3.8.x runtime) or API Gateway runtime 2.x.

// == Downloading the Header Injection Policy

// Currently, the Header Injection policy is available on Anypoint Exchange. The follow section describes the steps to download, set up, and apply these policies.

// To download the header policies:

// . Login to Anypoint Platform and go to Exchange.
// . Search for and download the policies, or use these URLs:
// +
// * Add Request Headers Policy
// +
// `+https://www.anypoint.mulesoft.com/exchange/?search=Add%20Request%20Headers%20Policy+`
// +
// //* Remove Request Headers Policy
// //+
// //`+https://www.anypoint.mulesoft.com/exchange/?search=Remove%20Request%20Headers%20Policy+`
// //+
// * Add Response Headers Policy
// +
// `+https://www.anypoint.mulesoft.com/exchange/?search=Add%20Response%20Headers%20Policy+`
// //+
// //* Remove Response Headers Policy
// //+
// //`+https://www.anypoint.mulesoft.com/exchange/?search=Remove%20Response%20Headers%20Policy+`
// +
// . Unzip each policy archive.

// An XML and YAML file appears in each of the folders created by unzipping the archives. For example, the add-request-header-policy folder contains the following files:

// * add-request.xml
// * add-request.yaml

// You use these files to set up the policy as described later.


// == Setting Up and Applying Header Policies

// If you have configured custom policies in Anypoint Platform, you already know how to configure the Header Injection policy. The following section describes how to set up and apply the policies in Anypoint Platform.

// To configure the Header Injection Policy:

// . Navigate to the main API Administration page.
// +
// . From the left navigation, select Custom Policies.
// +
// The Custom policies page appears listing any available custom policies for the API.
// +
// . Click *Add Custom Policy*.
// . In *Mule Version*, select the version of the Mule Runtime for which you want to configure the policy.
// . In *Name*, enter a name for the policy, for example `add request header policy`.
// . In *Policy Definition*, click *Choose File* to locate the YAML file that you downloaded (`add-request.yaml`).
// . In Policy Configuration, choose the XML file that you downloaded, for example, `add-request.xml`.
// . Click *Add*.
// +
// image::gw-add-custom-pol.png[]
// +
// The policy, add request header policy in this example, appears on the Custom Policies page.
// +
// image::gw-custom-pol-list.png[]

=== Applying the Header Injection Policy

Perform the following steps to apply the Header Injection policy:

. From your left navigation, select *API Administration*.
. If you already deployed the API version, select the version to which you want to apply the policy.
. From your left navigation, select *Policies*.
+
The policies details page appears.
+
If the header was already provided by the client or another policy, the value is overwritten with your header.
+
. Click *Apply New Policy*.
+
The Select Policy dialog box appears.
+
. From the policy list, select the *Header Injection* radio button and click *Configure Policy*. 
+
The Apply Header Removal policy page appears.
. In the Inbound Header Map box, type the name of the inbound header.
+
For example, type `in-header` in the box.
. In the Outbound Header Map box, type the name of the outbound header.
+
For example, type `out-header` in the box.
+
. Optionally, include MEL expressions in the value of the header.
+
For example, include the following expression to substitute the name of the user-agent in the header text.
+
`'#[message.inboundProperties['user-agent']]'`
+
image:apply-header-injection-policy.png[]
+
. Click *Apply*.
+
The Policies page is displayed with the Header Removal policy that you added.

